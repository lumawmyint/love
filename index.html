<!DOCTYPE html>
<html>

<head>
    <title>Expense Tracker with Balance</title>
    <style>
        body {
            font-family: 'Padauk', 'Myanmar Text', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .balance-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .positive {
            color: #28a745;
        }

        .negative {
            color: #dc3545;
        }

        .refresh-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        .day-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .date-header {
            background: #4285f4;
            color: white;
            padding: 8px 15px;
            margin: -15px -15px 15px -15px;
            border-radius: 8px 8px 0 0;
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }

        .day-total {
            font-weight: bold;
            text-align: right;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>Monthly Expense Tracker</h1>
        <button class="refresh-btn" onclick="loadData()">
            ðŸ”„ Refresh Data
        </button>
    </div>

    <div id="balance-container" class="balance-card">
        <!-- Balance will be inserted here -->
    </div>

    <div id="expenses-container">
        Loading expenses...
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzNvLXpP81As4DSa78LoZcE7V9qqR7V07e4HPJOTqQoqDesUtO8dNYth3H2b-APq5BRPw/exec";



        async function loadData() {
            try {
                document.getElementById('expenses-container').innerHTML = "Loading...";

                const response = await fetch(`${SCRIPT_URL}?t=${Date.now()}`);
                const data = await response.json();

                if (data.error) {
                    showError(data.error);
                    return;
                }

                updateBalance(data);
                displayExpenses(data);

            } catch (error) {
                showError(`Failed to load data: ${error.message}`);
            }
        }

        function updateBalance(data) {
            const balanceContainer = document.getElementById('balance-container');
            const remaining = data.remainingBalance;
            const isNegative = remaining < 0;

            balanceContainer.innerHTML = `
        <h2>Monthly Balance</h2>
        <div>Starting Capital: ${data.capital.toLocaleString()} THB</div>
        <div>Total Expenses: ${data.grandTotal.toLocaleString()} THB</div>
        <div class="${isNegative ? 'negative' : 'positive'}">
          Remaining Balance: ${Math.abs(remaining).toLocaleString()} THB
          ${isNegative ? '(Over Budget)' : ''}
        </div>
      `;
        }

        function displayExpenses(data) {
            const container = document.getElementById('expenses-container');

            if (!data.expenses || data.expenses.length === 0) {
                container.innerHTML = "<div>No expenses recorded yet</div>";
                return;
            }

            container.innerHTML = data.expenses.map(day => `
        <div class="day-card">
          <div class="date-header">
            ${new Date(day.date).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' })}
          </div>
          ${day.items.map(item => `
            <div class="expense-item">
              <span>${item.description}</span>
              <span>${item.amount.toLocaleString()} THB</span>
            </div>
          `).join('')}
          <div class="day-total">Day Total: ${day.total.toLocaleString()} THB</div>
        </div>
      `).join('');
        }

        function showError(message) {
            document.getElementById('expenses-container').innerHTML = `
        <div style="color: #dc3545; padding: 15px; border: 1px solid #dc3545; border-radius: 4px;">
          ${message}
        </div>`;
        }

        // Initial load
        loadData();
    </script>
</body>

</html>
